const bankUrl = "https://webapi.niftytrader.in/webapi/option/fatch-option-chain?symbol=banknifty&expiryDate="
const niftyUrl = "https://webapi.niftytrader.in/webapi/option/fatch-option-chain?symbol=nifty&expiryDate=";

async function getData() {
    const url = bankUrl
    try {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(`Response status: ${response.status}`);
      }
  
      const json = await response.json();
      console.log('getData => ', json);
    } catch (error) {
      console.error(error.message);
    }
  }

getData()




  
async function getData() {
  var jsonData;
    const url = "https://webapi.niftytrader.in/webapi/option/fatch-option-chain?symbol=nifty&expiryDate=";
    try {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(`Response status: ${response.status}`);
      }
      jsonData = await response.json();
      return jsonData
      
    } catch (error) {
      console.error(error.message);
    }
  }

function download(filename, text) {
      var element = document.createElement('a');
      element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
      element.setAttribute('download', filename);

      element.style.display = 'none';
      document.body.appendChild(element);

      element.click();

      document.body.removeChild(element);
    }

function triggerDataFetch() {
    var stringData = getData();
      stringData.then((data)=>{
        console.log('setTimeout stringData => ', data.resultData.opDatas);
        download("hello.txt", JSON.stringify(data.resultData.opDatas));
      })
}
setInterval(triggerDataFetch, 5000);








//FINAL WORKING CODE


const niftyAPI = "https://webapi.niftytrader.in/webapi/option/fatch-option-chain?symbol=nifty&expiryDate=";
const finAPI = "https://webapi.niftytrader.in/webapi/option/fatch-option-chain?symbol=finnifty&expiryDate=";
const bankAPI = "https://webapi.niftytrader.in/webapi/option/fatch-option-chain?symbol=banknifty&expiryDate="
var counterN = 0
var counterB = 0
var counterF = 0

async function getNiftyData() {
  var jsonData;
    const url = niftyAPI;
    try {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(`Response status: ${response.status}`);
      }
      jsonData = await response.json();
      return jsonData
    } catch (error) {
      console.error(error.message);
    }
  }
async function getBankData() {
  var jsonData;
    const url = bankAPI;
    try {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(`Response status: ${response.status}`);
      }
      jsonData = await response.json();
      return jsonData
    } catch (error) {
      console.error(error.message);
    }
  }
  async function getFinData() {
  var jsonData;
    const url = finAPI;
    try {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(`Response status: ${response.status}`);
      }
      jsonData = await response.json();
      return jsonData
      
    } catch (error) {
      console.error(error.message);
    }
  }
function download(filename, text) {
      var element = document.createElement('a');
      element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
      element.setAttribute('download', filename);
      element.style.display = 'none';
      document.body.appendChild(element);
      element.click();
      document.body.removeChild(element);
    }

function triggerDataFetchNifty() {
    counterN++;
    const fileName = 'nifty'+counterN+'.txt';
    const stringData = getNiftyData();
      stringData.then((data)=>{
        console.log('setTimeout stringData => ', data.resultData.opDatas);
        download(fileName, JSON.stringify(data.resultData.opDatas));
      })
}
function triggerDataFetchBank() {
    counterB++;
    const fileName = 'bank'+counterB+'.txt';
    const stringData = getBankData();
      stringData.then((data)=>{
        console.log('setTimeout stringData => ', data.resultData.opDatas);
        download(fileName, JSON.stringify(data.resultData.opDatas));
      })
}
function triggerDataFetchFin() {
    counterF++;
    const fileName = 'fin'+counterF+'.txt';
    const stringData = getFinData();
      stringData.then((data)=>{
        console.log('setTimeout stringData => ', data.resultData.opDatas);
        download(fileName, JSON.stringify(data.resultData.opDatas));
      })
}
setInterval(triggerDataFetchNifty, 15000);
setInterval(triggerDataFetchFin, 15000);
setInterval(triggerDataFetchBank, 15000);